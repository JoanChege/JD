{% extends "base.html" %}
{% block content %}
<h1>Checkout</h1>

<!-- Display Cart Summary -->
<h3>Order Summary</h3>
<table class="table">
    <thead>
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {% for item in cart %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ item.price }}</td>
                <td>${{ item.price * item.quantity }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<h4>Total: ${{ total }}</h4>

<!-- Payment Options -->
<h3>Select Payment Method</h3>

<!-- Visa Card Payment Form -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Pay with Visa Card</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('process_payment') }}">
            <div class="form-group">
                <label for="card_number">Card Number</label>
                <input type="text" class="form-control" id="card_number" name="card_number" placeholder="Enter card number" required>
            </div>
            <div class="form-group">
                <label for="expiry_date">Expiry Date</label>
                <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/YY" required>
            </div>
            <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" class="form-control" id="cvv" name="cvv" placeholder="CVV" required>
            </div>
            <input type="hidden" name="payment_method" value="visa">
            <button type="submit" class="btn btn-primary">Pay with Visa</button>
        </form>
    </div>
</div>

<!-- M-Pesa Payment Instructions -->
<div class="card">
    <div class="card-header">
        <h5>Pay with M-Pesa</h5>
    </div>
    <div class="card-body">
        <p>To complete your payment via M-Pesa, follow these steps:</p>
        <ol>
            <li>Go to your M-Pesa menu.</li>
            <li>Select <strong>Lipa na M-Pesa</strong>.</li>
            <li>Enter the following details:</li>
            <ul>
                <li><strong>Paybill Number:</strong> 123456</li>
                <li><strong>Account Number:</strong> {{ current_user.id }}</li>
            </ul>
            <li>Confirm the payment.</li>
        </ol>
        <p>Once the payment is complete, click the button below to confirm your order.</p>
        <form method="POST" action="{{ url_for('process_payment') }}">
            <input type="hidden" name="payment_method" value="mpesa">
            <button type="submit" class="btn btn-success">Confirm M-Pesa Payment</button>
        </form>
    </div>
</div>

{% endblock %}